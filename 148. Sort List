/**
 * Definition of ListNode
 * class ListNode {
 * public:
 *     int val;
 *     ListNode *next;
 *     ListNode(int val) {
 *         this->val = val;
 *         this->next = NULL;
 *     }
 * }
 */
 Version 1：Merge Sort。
class Solution {
public:
    /**
     * @param head: The first node of linked list.
     * @return: You should return the head of the sorted linked list,
                    using constant space complexity.
     */
    ListNode *sortList(ListNode *head) {
        // write your code here
        if(head==NULL || head->next==NULL){
            return head;
        }
        
        ListNode *s=head, *f=head->next;
        while(f!=NULL&&f->next!=NULL){
            s=s->next;
            f=f->next->next;
        }
        ListNode *m=s->next;
        s->next=NULL;
        
        ListNode *left=sortList(head);
        ListNode *right=sortList(m);//此处如果为m->next出错，必须改为这种
        
        ListNode *o=merge(left,right);
        return o;
    }
    ListNode *merge(ListNode *left, ListNode *right){
        if(left==NULL)
            return right;
        if(right==NULL)
            return left;
        
        ListNode *head,*temp;
        if(left->val<=right->val){
            head=left;
            left=left->next;
        }else{
            head=right;
            right=right->next;
        }
        temp=head;
        
        while(left!=NULL&&right!=NULL){
            if(left->val<=right->val){
                temp->next=left;
                left=left->next;
            }else{
                temp->next=right;
                right=right->next;
            }
            temp=temp->next;
        }
        if(left!=NULL)
            temp->next=left;
        if(right!=NULL)
            temp->next=right;
            
        return head;
    }
    
};
